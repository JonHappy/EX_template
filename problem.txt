есть проблемный кусок в в файле pic.html
начинается  так
//            <%-- обрезка --%>
            $(document).on('click', '#crop_button', function () {
 вот само проблемное место

  *              context.translate(sq / 2, sq / 2);
                context.rotate((img.rotate * Math.PI) / 180);
                var z1=-sq / 2;
                context.drawImage(pic, z1, z1);
               pic.src = canvas.toDataURL("image/jpeg", 1.0);
                canvas.height = crop.height;
                canvas.width = crop.width;
                x = (sq - crop.width) / 2;
                y = (sq - crop.height) / 2;

                context.drawImage(pic, x, y, crop.width, crop.height, 0, 0, crop.width, crop.height);
                var k = crop.id === 0 ? 1.0 : 0.75;
                document.querySelector('.cropped').innerHTML += '<div ><img id="' + crop.id + '" src="' + canvas.toDataURL("image/jpeg", k) + '"></div>';
                $('#' + crop.id).parent().append('<img src="pic/del_.png" class="del"  width="18" height="18" alt="del"/>');

если в отладчике мозилы поставить точку остановки на строке с * и по шагам произвести выполенеие
то всё выполнится правильно.
в реалтайме гдючит.
Есть подозрение что команды context.drawImage выполняются долго, но возврат из них происходит раньше, чем закончится обработка данных.
В хроме всё работает великолепно.
